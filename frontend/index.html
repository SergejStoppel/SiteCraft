<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SiteCraft - Website Accessibility Audit</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8fafc;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2563eb;
            margin-bottom: 1rem;
        }

        .header p {
            font-size: 1.2rem;
            color: #6b7280;
        }

        .audit-form {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        input[type="url"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input[type="url"]:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            background: #2563eb;
            color: white;
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background: #1d4ed8;
        }

        .btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
        }

        .score {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .score-level {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .issues-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .issue-card {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }

        .issue-count {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .critical { color: #dc2626; }
        .high { color: #ea580c; }
        .medium { color: #d97706; }
        .low { color: #65a30d; }

        .issues-list {
            margin-bottom: 2rem;
        }

        .issue-item {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 8px 8px 0;
        }

        .issue-item.high {
            background: #fff7ed;
            border-left-color: #ea580c;
        }

        .issue-item.medium {
            background: #fffbeb;
            border-left-color: #d97706;
        }

        .issue-item.low {
            background: #f7fee7;
            border-left-color: #65a30d;
        }

        .issue-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .issue-suggestion {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .recommendations {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .recommendations h3 {
            color: #1e40af;
            margin-bottom: 1rem;
        }

        .recommendations ul {
            list-style: none;
        }

        .recommendations li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .recommendations li:last-child {
            border-bottom: none;
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üîç SiteCraft</h1>
            <p>Professional Website Accessibility Audit</p>
        </header>

        <form class="audit-form" id="auditForm">
            <div class="form-group">
                <label for="websiteUrl">Website URL</label>
                <input 
                    type="url" 
                    id="websiteUrl" 
                    name="websiteUrl" 
                    placeholder="https://example.com"
                    required
                >
            </div>
            <button type="submit" class="btn" id="submitBtn">
                Start Accessibility Audit
            </button>
        </form>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing website accessibility...</p>
            <p style="color: #6b7280; font-size: 0.9rem;">This may take 10-30 seconds</p>
        </div>

        <div class="results" id="results">
            <div class="score-card">
                <div class="score" id="overallScore">--</div>
                <div class="score-level" id="scoreLevel">Accessibility Score</div>
            </div>

            <div class="issues-summary" id="issuesSummary">
                <div class="issue-card">
                    <div class="issue-count critical" id="criticalCount">0</div>
                    <div>Critical Issues</div>
                </div>
                <div class="issue-card">
                    <div class="issue-count high" id="highCount">0</div>
                    <div>High Priority</div>
                </div>
                <div class="issue-card">
                    <div class="issue-count medium" id="mediumCount">0</div>
                    <div>Medium Priority</div>
                </div>
                <div class="issue-card">
                    <div class="issue-count low" id="lowCount">0</div>
                    <div>Low Priority</div>
                </div>
            </div>

            <div class="issues-list" id="issuesList">
                <h3>Accessibility Issues Found</h3>
            </div>

            <div class="recommendations" id="recommendations">
                <h3>üí° Recommendations</h3>
                <ul id="recommendationsList"></ul>
            </div>
        </div>

        <div class="error" id="error" style="display: none;">
            <strong>Error:</strong> <span id="errorMessage"></span>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        document.getElementById('auditForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const url = document.getElementById('websiteUrl').value;
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const error = document.getElementById('error');
            
            // Hide previous results and errors
            results.style.display = 'none';
            error.style.display = 'none';
            
            // Show loading
            loading.style.display = 'block';
            submitBtn.disabled = true;
            submitBtn.textContent = 'Analyzing...';
            
            try {
                // Start audit
                const auditResponse = await fetch(`${API_BASE}/audit/scan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        url: url,
                        auditType: 'ACCESSIBILITY_FOCUS'
                    })
                });
                
                const auditData = await auditResponse.json();
                
                if (!auditData.success) {
                    throw new Error(auditData.message || 'Failed to start audit');
                }
                
                const auditId = auditData.auditId;
                
                // Poll for results
                let attempts = 0;
                const maxAttempts = 30; // 30 seconds max
                
                const pollResults = async () => {
                    attempts++;
                    
                    const resultResponse = await fetch(`${API_BASE}/audit/results/${auditId}`);
                    const resultData = await resultResponse.json();
                    
                    if (resultData.success && resultData.status === 'COMPLETED') {
                        // Display results
                        displayResults(resultData);
                        loading.style.display = 'none';
                        results.style.display = 'block';
                    } else if (resultData.status === 'FAILED') {
                        throw new Error(resultData.message || 'Audit failed');
                    } else if (attempts < maxAttempts) {
                        // Continue polling
                        setTimeout(pollResults, 2000);
                    } else {
                        throw new Error('Audit timeout - please try again');
                    }
                };
                
                // Start polling after a short delay
                setTimeout(pollResults, 2000);
                
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                document.getElementById('errorMessage').textContent = err.message;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Start Accessibility Audit';
            }
        });
        
        function displayResults(data) {
            const accessibility = data.accessibilityAnalysis;
            
            // Update score
            document.getElementById('overallScore').textContent = accessibility.score;
            document.getElementById('scoreLevel').textContent = `${accessibility.level} Compliance`;
            
            // Update issue counts
            document.getElementById('criticalCount').textContent = accessibility.summary.critical;
            document.getElementById('highCount').textContent = accessibility.summary.high;
            document.getElementById('mediumCount').textContent = accessibility.summary.medium;
            document.getElementById('lowCount').textContent = accessibility.summary.low;
            
            // Display issues
            const issuesList = document.getElementById('issuesList');
            issuesList.innerHTML = '<h3>Accessibility Issues Found</h3>';
            
            if (accessibility.issues.length === 0) {
                issuesList.innerHTML += '<p style="color: #16a34a; font-weight: 600;">üéâ No accessibility issues found!</p>';
            } else {
                accessibility.issues.forEach(issue => {
                    const issueDiv = document.createElement('div');
                    issueDiv.className = `issue-item ${issue.severity}`;
                    issueDiv.innerHTML = `
                        <div class="issue-title">
                            ${issue.message}
                            <span style="background: #f3f4f6; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-left: 8px;">
                                WCAG ${issue.wcagLevel}
                            </span>
                        </div>
                        <div class="issue-suggestion">${issue.suggestion}</div>
                    `;
                    issuesList.appendChild(issueDiv);
                });
            }
            
            // Display recommendations
            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = '';
            
            accessibility.recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationsList.appendChild(li);
            });
        }
    </script>
</body>
</html>